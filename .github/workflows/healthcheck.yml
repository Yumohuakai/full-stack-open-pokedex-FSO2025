name: test - Periodic health check

on:
  schedule:
    # * is a special character in YAML so you have to quote this string
    # Due to I use Helsinki time zone (UTC +3), 
    # so if I want to do the schedule testing at 11am/13th/month, I need to reduce 3 hours
    - cron:  '0 8 13 * *'  # minute(0-59) hour(0-23) date(1-31) month(1-12) weekday(0-6, 0 is sunday)
    # - cron:  '15 * * * *'  # in discord webhook channel, it sent at 16:02, 16:47(45min), 17:38(51min), 18:35(57min) on 2025.8.12

jobs:
  health_check:
    runs-on: ubuntu-latest
    steps:
      - name: Scheduled Health check
        # the tag of url-health-check-action currently for this hash code is v4 (Using Node v20)
        uses: jtalk/url-health-check-action@b716ccb6645355dd9fcce8002ce460e5474f7f00
        with:
          url: https://full-stack-open-pokedex-fso2025.onrender.com/health
          max-attempts: 3 # Optional, defaults to 1
          retry-delay: 5s # Optional, only applicable to max-attempts > 1             
      - name: Scheduled Health check Success notification to webhhook only for testing
        if: ${{ success() }}
        # the version of actions-status-discord currently for this hash code is 1.15.3
        uses: sarisia/actions-status-discord@5ddd3b114a98457dd80a39b2f00b6a998cd69008
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
      - name: Scheduled Health check Failure notification to webhhook only for testing
        if: ${{ failure() }}
        # the version of actions-status-discord currently for this hash code is 1.15.3
        uses: sarisia/actions-status-discord@5ddd3b114a98457dd80a39b2f00b6a998cd69008
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }} 